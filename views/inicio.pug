extends ./layout/index

block contenido
    //- ============================================
    //- 1. EL CARRUSEL
    //- ============================================
    if pagina === 'Inicio'
        #carouselInicio.carousel.slide(data-ride="carousel" data-interval="3000")
            ol.carousel-indicators
                li.active(data-target="#carouselInicio" data-slide-to="0")
                li(data-target="#carouselInicio" data-slide-to="1")
                li(data-target="#carouselInicio" data-slide-to="2")

            .carousel-inner(style="max-height: 450px;")
                .carousel-item.active
                    img.d-block.w-100(src="https://images.unsplash.com/photo-1481627834876-b7833e8f5570?auto=format&fit=crop&w=1350&q=80" alt="Librería" style="object-fit: cover; height: 450px; filter: brightness(0.7);")
                    .carousel-caption.d-none.d-md-block
                        h2(style="font-family: 'Playfair Display', serif; font-size: 3rem;") Bienvenido
                        p.lead Encuentra tu próxima gran historia.
                .carousel-item
                    img.d-block.w-100(src="https://images.unsplash.com/photo-1512820790803-83ca734da794?auto=format&fit=crop&w=1350&q=80" alt="Lectura" style="object-fit: cover; height: 450px; filter: brightness(0.7);")
                    .carousel-caption.d-none.d-md-block
                        h2(style="font-family: 'Playfair Display', serif;") Pasión por Leer
                        p.lead Déjate llevar por la magia de las palabras.
                .carousel-item
                    img.d-block.w-100(src="https://images.unsplash.com/photo-1491841550275-ad7854e35ca6?auto=format&fit=crop&w=1350&q=80" alt="Novedades" style="object-fit: cover; height: 450px; filter: brightness(0.7);")
                    .carousel-caption.d-none.d-md-block
                        h2(style="font-family: 'Playfair Display', serif;") Novedades
                        p.lead Los títulos más vendidos del mes.

            a.carousel-control-prev(href="#carouselInicio" role="button" data-slide="prev")
                span.carousel-control-prev-icon
            a.carousel-control-next(href="#carouselInicio" role="button" data-slide="next")
                span.carousel-control-next-icon

    //- ============================================
    //- 2. RESULTADOS (GRILLA PERFECTA)
    //- ============================================
    .container.my-5
        h2.text-center.mb-5.font-weight-bold(style="font-family: 'Playfair Display', serif;") #{pagina === 'Inicio' ? 'Recomendaciones' : pagina}

        if libros && libros.length > 0
            //- GRID: Usamos row-cols-lg-3 (3 columnas) o 2 si prefieres muy grandes.
            //- g-4 da espacio uniforme entre tarjetas.
            .row.row-cols-1.row-cols-md-2.row-cols-lg-3.g-4
                each libroItem in libros
                    //- --- DATOS ---
                    - var info = libroItem.volumeInfo || libroItem
                    - var sale = libroItem.saleInfo || {}
                    - var titulo = info.title || libroItem.titulo || 'Sin título'
                    - var id = libroItem.id || libroItem._id

                    //- AUTORES
                    - var autores = 'Autor desconocido'
                    if info.authors
                        - autores = Array.isArray(info.authors) ? info.authors.join(', ') : info.authors
                    else if libroItem.autor
                        - autores = libroItem.autor
                    else if libroItem.autores
                        - autores = libroItem.autores

                    //- PRECIO
                    - var enVenta = (sale.saleability === 'FOR_SALE')
                    - var precio = 'No disponible'
                    if enVenta && sale.listPrice
                        - precio = sale.listPrice.amount + ' €'
                    else if libroItem.precio
                        - precio = libroItem.precio

                    //- --- LÓGICA DE IMAGEN ---
                    //- 1. Definimos una imagen por defecto (Placeholder gris bonito)
                    - var imagen = 'https://via.placeholder.com/300x450/e9ecef/868e96?text=Sin+Portada'
                    //- 2. Si Google tiene imagen, la usamos
                    if info.imageLinks && info.imageLinks.thumbnail
                        - imagen = info.imageLinks.thumbnail
                    //- 3. Si viene de tu BBDD, la usamos
                    else if libroItem.imagen
                        - imagen = libroItem.imagen

                    //- --- TARJETA ---
                    .col
                        .card.h-100.shadow-sm.border-0
                            //- CONTENEDOR DE IMAGEN UNIFORME
                            //- bg-light crea un fondo gris suave si el libro es estrecho
                            //- height fijo de 400px (500px era excesivo) para alinear todas
                            .div.bg-light.d-flex.align-items-center.justify-content-center(style="height: 400px; overflow: hidden; border-radius: 5px 5px 0 0;")
                                img(src=imagen alt=titulo style="height: 100%; width: 100%; object-fit: contain;" referrerpolicy="no-referrer")

                            .card-body.d-flex.flex-column
                                //- TÍTULO (Máximo 2 líneas)
                                h5.card-title.fw-bold.text-center.mt-2(style="font-size: 1.1rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 2.8em;" title=titulo)= titulo

                                //- AUTOR (1 línea)
                                p.text-muted.text-center.small.mb-3(style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;") #{autores}

                                //- PRECIO Y BOTÓN (Siempre abajo)
                                .mt-auto.pt-3.border-top
                                    .d-flex.justify-content-between.align-items-center.mb-3
                                        span.h4.mb-0.font-weight-bold.text-dark #{precio}
                                        if enVenta
                                            span.badge.badge-success En Stock

                                    if id
                                        a.btn.btn-outline-primary.btn-block.rounded-pill(href='/libro/' + id) Ver Ficha
                                    else
                                        button.btn.btn-secondary.btn-block(disabled) Error
        else
            .alert.alert-warning.text-center.mt-5 No se encontraron libros.